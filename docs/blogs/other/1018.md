---
title: SQL server 一些命令
date: 2020-10-18
tags:
 - sqlserver
categories:
 - 数据库
---

```sql
主键约束 	PRIMARY KEY
外键约束 	FOREIGN KEY
默认值约束 	DEFAULT 
自增ID 	IDENTITY(1,1) 第一个种子值，第二个步长

```

## 一.定义

### 1.模式

**sqlserver数据库的结构为:**
数据库–>模式–>表／视图/存储过程／函数／触发器
模式就是数据库中一类对象的集合

定义模式

```sql
CREATE SCHEMA <模式名> AUTHORIZATION <用户名>
```

当模式名缺省时，自动创建一个模式名为用户名的模式

```sql
DROP SCHEMA <模式名>  <CASCADE|RESTRICT>  --cascade(级联),   restrict(限制)
```

cascade(级联)表示在删除模式的同时把该模式中所有的数据库对象全部删除
restrict(限制)表示如果该模式中已经定义了下属的数据库对象，如表或视图等，则拒绝该删除语句的执行。

### 2.表的定义、删除与修改

2.1 定义基本表

:::tip

列级约束有六种：主键Primary key、外键foreign key 、唯一 unique、检查 checck 、默认default 、非空/空值 not null/ null   
表级约束有四种：主键、外键、唯一、检查

:::

创建一个模式就是建立了一个数据库（命名空间）

```   sql
CREATE TABLE <表名> (<列名>  <数据类型> [列级约束条件]
					, <表级完整性约束条件>)
```

[例1]

```sql
CREATE TABLE Student
					(Sno CHAR(7) PRIMARY KEY,
					Sname CHAR(20) UNIQUE,
					Ssex CHAR(2),
					Sage SMALLINT,
					Sdept CHAR(20)
					);
```

[例2]

```sql
CREATE TABLE Course
					(Cno CHAR(4) PRIMARY KEY,
					 Cname CHAR(40),
                     Cpno CHAR(4),
                     Ccredit SMALLINT,
                     FOREIGN KEY Cpno REFERENCES Course(Cno)
					);
--Cpno是外码
```

```sql
CREATE TABLE SC
				(Sno CHAR(7),
				 Cno CHAR(4),
				 Grade SMALLINT,
				 PRIMARY KEY(Sno,Cno),
				 FORENGIN KEY Sno REFERENCES Student(Sno),
				 FORENGIN KEY Cno REFERENCES Course(Cno)
				 );
```

2.2 数据类型

### 3.模式与表

**方法一：** 在创建表时，显示给出模式名

```sql
CREATE TABLE S-T.Student(.....)
```

**方法二：** 创建模式时同时创建表

**方法三：** 设置所属模式

### 4.修改表

使用 `ALTER TABLE` 修改

```sql
ALTER TABLE <表名>
				[ADD <新列名> <数据类型> <完整性约束>] --增加新列  
				[DROP <完整性约束名>]   
				[MODIFY <列名> <数据类型>]
```

```sql
ALTER TABLE Student ADD S_en DATE;
ALTER TABLE Student MODIFY Sage INT; --修改原有列属性可能会破坏  
ALTER TABLE Student DROP UNIQUE(Sname)
```

使用`DROP TABLE` 删除表。

```sql
DROP TABLE Student;
```

### 5.索引的建立与删除

#### 5.1建立

建立索引是加快查询速度的有效手段。分为聚集索引和非聚集索引

## 二.数据查询

```sql
SELECT [ALL|DISTINCT] <目标列表达式> 
FROM <表名或视图名>
WHERE <条件表达式>
GROUP BY <列名> HAVING <条件表达式>
```

### 1.单表查询

```sql
SELECT DISTINCT Sno
FROM SC; --去重
```

1.1查询满足条件的元组，通过 `WHERE` 实现 

| 查询条件 | 谓词                        |
| -------- | --------------------------- |
| 比较     | =,<,>,>=,<=,!=,<>,!>,!<     |
| 确定范围 | BETWEEN AND,NOT BETWEEN AND |
| 确定集合 | IN,NOT IN                   |
| 字符匹配 | LIKE,NOT LIKE               |
| 空值     | IS NULL,NOT IS NULL         |
| 多重条件 | AND,OR,NOT                  |



```sql
SELECT Sname FROM Student WHERE Sdept='CS';
SELECT Sname,Ssex FROM Student  WHERE Sdept NOT IN ('CS','MA','IS')  
SELECT Sname,Sno,Ssex FROM Student WHERE Sname LIKE '刘%'； --查询所有姓刘的学生姓名，学号和性别  
SELECT Sname FROM Student WHERE Sname LIKE '欧阳_'  
SELECT Sno,Cno FROM SC WHERE Grade IS NULL  
SELECT Sname FROM Student WHERE Sdept='CS' AND Sage <20;  


```

1.2 `ORDER BY` 子句：对查询结果按照一个或多个属性列的升序（ASC）或降序（DESC）排列，默认为升序。

```sql
SELECT Sno,Grade
FROM SC
WHERE Cno='3'
ORDER BY Grade DESC;
```

1.3聚集函数 

` COUNT`,`SUM`,`AVG`,`MAX`,`MIN`

```sql
COUNT([DISTINCT|ALL],[*|列名])
```

1.4`GROUP BY`子句：将查询结果按照某一列或多列的值分组，值相等的为一组

**待补充**

### 2.多表查询

## 三.视图

###                                                                                                                                                                                                                                                                                                                                                                                                                        1.建立视图

```sql
CREATE VIEW <视图名> [列名，列名...]
AS 子查询
[WHERE CHECK OPTION]
```

`子查询可以是任意SELECT语句，但通过不允许含有ORDER BY 子句和DISTINCT 短语`

 **WHERE CHECK OPTIN**对视图进行update,insert,delete时要保证行满足视图定义中的谓词条件(即子查询中的条件表达式);

### 2.删除视图

```sql
DROP VIEW <视图名> 
```

### 3.查询视图

视图就相当于一个虚拟表，所以所有对基本表的查询语句，对视图也同样适用

### 4.视图更新

对视图的更新最终会转换成对基本表的更新。
可用操作有update,insert,delete，

### 例子

```sql
CREATE TABLE  zuo
(ID  INT IDENTITY(1,1) PRIMARY KEY,
COL  INT DEFAULT(100),
SEX  INT CHECK(SEX=0 OR SEX=1),
RAD INT FOREIGN KEY REFERENCES S_id(id))
```

 